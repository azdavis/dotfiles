#!/usr/bin/env sh

source "$HOME/.config/etc/base.sh"

log() {
    echo "$1" >> "$HOME/Library/Logs/backup.log"
}

bk_name="$(uname -n)@$(date +%Y-%m-%dT%H:%M:%S)"
now="$(date +%s)"

log "name: $bk_name"
log "ping: $(
    ping -c1 -t5 8.8.8.8 \
    > /dev/null 2>&1 \
    && echo y \
    || echo n
)"
cd "$(dirname "$bk_loc")"
log "done: $(
    tarsnap --dry-run -cf "$bk_name" "$(basename "$bk_loc")" \
    > /dev/null 2>&1 \
    && echo y \
    || echo n
)"
log "time: $(expr "$(date +%s)" - "$now")s"
log "----------"
