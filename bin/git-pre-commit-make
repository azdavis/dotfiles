#!/bin/sh

set -eu
. "$HOME/.config/lib/panic.sh"

git rev-parse
cd "$(git rev-parse --show-toplevel)"

if ! [ -f GNUmakefile ] && ! [ -f Makefile ] && ! [ -f makefile ]; then
	panic "no makefile"
fi

dst=".git/hooks/pre-commit"

if [ -e "$dst" ]; then
	panic "a pre-commit hook already exists"
fi

mkdir -p "$(dirname "$dst")"
cat <<EOF > "$dst"
#!/bin/sh
exec make
EOF
chmod +x "$dst"
