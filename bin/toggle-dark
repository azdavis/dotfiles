#!/bin/sh

set -eu

panic() {
  echo "$1" >&2
  exit 1
}

if [ "$#" -ne 0 ]; then
  panic "usage: $0"
fi

cd "$HOME/.config"

sys_dark_mode="Application('System Events').appearancePreferences.darkMode"
new_dark="$(osascript -l JavaScript -e "! $sys_dark_mode()")"
p="etc/dark.patch"

if "$new_dark"; then
  git_direction=""
else
  git_direction="--reverse"
fi

git apply $git_direction "$p"
osascript -l JavaScript -e "$sys_dark_mode = $new_dark" >/dev/null
