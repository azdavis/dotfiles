#!/bin/sh

set -eu

. "$HOME/.config/lib/panic.sh"

if [ "$#" -ne 0 ]; then
    panic "usage: $(basename "$0")"
fi

cd "$HOME/.config"

new_dark="$(osascript -l JavaScript -e "
!Application('System Events').appearancePreferences.darkMode()
")"
p=etc/dark.patch

if "$new_dark"; then
    iterm_profile=dark
    git_direction=""
else
    iterm_profile=light
    git_direction="--reverse"
fi

git apply $git_direction "$p"
printf "\033]50;SetProfile=$iterm_profile\a"
osascript -l JavaScript -e "
Application('System Events').appearancePreferences.darkMode = $new_dark
" >/dev/null
