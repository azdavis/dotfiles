#!/bin/sh

set -eu

cd "$HOME/.dotfiles"

sys_dark_mode="Application('System Events').appearancePreferences.darkMode"
new_dark="$(osascript -l JavaScript -e "! $sys_dark_mode()")"

mk_theme_str() {
  echo "\"workbench.colorTheme\": \"Default $1+\""
}

light_theme="$(mk_theme_str Light)"
dark_theme="$(mk_theme_str Dark)"

if "$new_dark"; then
  old_theme="$light_theme"
  new_theme="$dark_theme"
else
  old_theme="$dark_theme"
  new_theme="$light_theme"
fi

osascript -l JavaScript -e "$sys_dark_mode = $new_dark" >/dev/null

settings='vscode/settings.json'
tmp='settings.tmp'
sed "s/$old_theme/$new_theme/" "$settings" > "$tmp"
mv "$tmp" "$settings"
