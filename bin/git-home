#!/bin/sh

set -eu

panic() {
	echo "$1" >&2
	exit 1
}

if [ "$#" -ne 0 ]; then
	panic "usage: $0"
fi

git rev-parse

branch="$(git symbolic-ref --short HEAD)"
if ! remote="$(git config branch.$branch.remote)"; then
	panic "could not get remote for branch '$branch'"
elif ! url="$(git config remote.$remote.url)"; then
	panic "could not get url for remote '$remote'"
fi
url="$(echo "$url" | sed -e 's/\.git$//' -e 's#^git@github.com:#https://github.com/#')"

if printf '%s' "$url" | grep -qe '^https://git\(hub\|lab\).com/'; then
	open "$url/tree/$branch"
else
	open "$url"
fi
