#!/usr/bin/env sh

. "$HOME/.config/lib/base.sh"
. "$HOME/.config/lib/abort.sh"

username="$(git config --global user.name)" \
    || abort "no git user.name found"

printf "github token: "
read github

git credential-osxkeychain erase <<EOS
host=github.com
protocol=https
EOS

git credential-osxkeychain store <<EOS
host=github.com
protocol=https
password=$github
username=$username
EOS

cat <<EOS > "$HOME/.config/hub"
github.com:
- user: $username
  oauth_token: $github
  protocol: https
EOS

printf "gitlab password: "
read gitlab

git credential-osxkeychain erase <<EOS
host=gitlab.com
protocol=https
EOS

git credential-osxkeychain store <<EOS
host=gitlab.com
protocol=https
password=$gitlab
username=$username
EOS
