#!/bin/sh

set -eu

panic() {
  echo "$1" >&2
  exit 1
}

if [ "$#" -ne 0 ]; then
  panic "usage: $(basename "$0")"
fi

git \
  -c gc.reflogExpire=0 \
  -c gc.reflogExpireUnreachable=0 \
  -c gc.rerereresolved=0 \
  -c gc.rerereunresolved=0 \
  -c gc.pruneExpire=now \
  gc
git repack -adf --depth=50 --window=50
git fsck --strict --unreachable
