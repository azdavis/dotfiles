#!/usr/bin/env sh

source "$HOME/.config/etc/base.sh"

cd "$HOME/.config/pkg"

which brew > /dev/null || curl -fsSL "https://git.io/pVOl" | ruby
brew update
brew upgrade
formula="$(brew --prefix)/Library/Taps/homebrew/homebrew-core/Formula"
cd "$formula"
git apply ~/.config/etc/patch/*
cd "$HOME/.config/pkg"
brew bundle --verbose
cd "$formula"
git checkout .
cd "$HOME/.config/pkg"
brew bundle cleanup --force
brew cask cleanup --force
brew cleanup --force
brew prune
brew doctor || true

tlmgr update --self
tlmgr update --all
tlmgr install $(cat tlmgrfile)
