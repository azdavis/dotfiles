#!/bin/sh -eu

. "$HOME/.config/lib/cmd_found.sh"
. "$HOME/.config/lib/panic.sh"

if [ $# -ne 0 ]; then
	panic "usage: $(basename "$0")"
fi

if cmd_found brew; then
	echo "doing 'brew'"
	brew update
	brew bundle --verbose --global
	brew bundle cleanup --force --global
	brew upgrade
	brew unlink coreutils >/dev/null
	brew cask cleanup
	brew cleanup
	brew prune
else
	echo "'brew' not found"
fi

if cmd_found tlmgr; then
	echo "doing 'tlmgr'"
	tlmgr update --self
	tlmgr update --all
else
	echo "'tlmgr' not found"
fi

if cmd_found npm; then
	echo "doing 'npm'"
	npm update -g npm
	for x in "$(npm config get prefix)/lib/node_modules"/*; do
		if [ "$x" != npm ]; then
			npm update -g "$x"
		fi
	done
else
	echo "'npm' not found"
fi
