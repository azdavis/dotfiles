#!/usr/bin/env sh

. "$HOME/.config/etc/base.sh"

cd "$HOME/.config/pkg"

brew update
brew upgrade
formula="$(brew --repo)/Library/Taps/homebrew/homebrew-core/Formula"
cd "$formula"
git apply ~/.config/patch/*
cd "$HOME/.config/pkg"
brew bundle --verbose
cd "$formula"
git checkout .
cd "$HOME/.config/pkg"
brew bundle cleanup --force
brew cask cleanup --force
brew cleanup --force
brew prune
brew doctor || true

tlmgr update --self
tlmgr update --all
tlmgr install $(cat tlmgrfile)
