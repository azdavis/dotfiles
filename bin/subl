#!/usr/bin/env zsh

source "$HOME/.config/misc/base"

rm_irf() {
  [[ -e "$1" || -h "$1" ]] || return 0
  echo -n "destroy $1 [yn]? "
  read x
  [[ "$x" == 'y' ]] || exit 1
  rm -rf "$1"
}

if pgrep -f 'Sublime Text' > /dev/null; then
  err 'sublime text must not be running'
fi

support="$HOME/Library/Application Support/Sublime Text 3"
app='/Applications/Sublime Text.app/Contents'

rm_irf "$support"
mkdir -p "$support"
ln -s "$HOME/.config/subl" "$support/Packages"

rm_irf '/usr/local/bin/edit'
ln -s "$app/SharedSupport/bin/subl" '/usr/local/bin/edit'

echo -n 'install package control [yn]? '
read x
[[ "$x" == 'y' ]] || exit 1
open 'https://packagecontrol.io/installation'
