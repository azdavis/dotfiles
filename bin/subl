#!/usr/bin/env zsh

source "$HOME/.config/misc/base.sh" || exit 1

rm_rf() {
  [[ ! -e "$1" || -h "$1" ]] && return 0
  echo -n "rm $1 [yn]? " && read x
  [[ "$x" == 'y' ]] && rm -rf "$1"
}

ln_s() {
  rm_rf "$2"
  ln -ins "$1" "$2"
}

if pgrep -f 'Sublime Text' > /dev/null; then
  err 'sublime text must not be running'
fi

support="$HOME/Library/Application Support/Sublime Text 3"
mkdir -p "$support/Packages"
rm_rf "$support/Cache"
rm_rf "$support/Local/Session.sublime_session"
rm_rf "$support/Local/Auto Save Session.sublime_session"
ln_s "$HOME/.config/subl" "$support/Packages/User"

ln_s \
  '/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl' \
  '/usr/local/bin/edit'

echo -n 'install package control [yn]? ' && read x
[[ "$x" == 'y' ]] && open 'https://packagecontrol.io/installation'

true
