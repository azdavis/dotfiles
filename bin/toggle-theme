#!/bin/sh -eu

. ~/.config/lib/panic.sh

if [ $# -ne 0 ]; then
	panic "usage: $(basename "$0")"
fi

cd ~/.config

p="$PWD/theme/dark.patch"
iterm_profile=""
git_direction=""
if git apply --check "$p" 2> /dev/null; then
	iterm_profile="dark"
	git_direction=""
elif git apply --check --reverse "$p" 2> /dev/null; then
	iterm_profile="light"
	git_direction="--reverse"
else
	panic "'$p' does not apply in either direction"
fi

git apply $git_direction "$p"
printf "\033]50;SetProfile=$iterm_profile\a"
