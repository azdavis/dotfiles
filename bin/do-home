#!/bin/sh

set -eu
IFS=

# warning: set -f is NOT on

. $HOME/.config/lib/panic.sh

if [ $# -ne 0 ]; then
    panic "usage: $(basename $0)"
fi

touch $HOME/.hushlogin
chmod 600 $HOME/.hushlogin

wd=.config/home
cd $HOME/$wd
for x in *; do
    src="$wd/$x"
    dst="$HOME/.$x"
    if [ -e "$dst" ]; then
        if [ -L "$dst" ]; then
            continue
        fi
        printf 'rm %s? ' "$dst"
        read ans
        if [ "$ans" != y ]; then
            continue
        fi
        rm -rf "$dst"
    fi
    mkdir -p "$(dirname "$dst")"
    ln -s "$src" "$dst"
done

cd
for x in .*; do
    if [ -L $x ] && ! [ -e $x ]; then
        rm $x
    fi
done
