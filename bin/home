#!/usr/bin/env zsh

set -euo pipefail
IFS=$'\n\t'
[[ "$USER" == 'root' ]] && echo 'do not run as root' && exit 1

rm_irf() {
  [[ -e "$1" || -h "$1" ]] || return 0
  echo -n "destroy $1 [yn]? "
  read x
  [[ "$x" == 'y' ]] || exit 1
  rm -rf "$1"
}

wd="$HOME/.config/home"
cd "$wd"

touch "$HOME/.hushlogin"
for f in $(find *); do
  if [[ -d "$f" ]]; then
    mkdir -p "$HOME/.$f"
  else
    rm_irf "$HOME/.$f"
    ln -s "$wd/$f" "$HOME/.$f"
  fi
done
